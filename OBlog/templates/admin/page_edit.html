{% extends "admin/layout.html" %} {% block title %}页面模板-管理员界面{% endblock %}{% block admin_content %}

<div v-bind:class="pathClass">
    <div class="input-group" v-bind:class="pathClass">
        <span class="input-group-addon" id="path">./back/theme/default/pages/</span>
        <input type="text" class="form-control" aria-describedby="path" v-model="path" name="path" placeholder="文件名">
        <span class="input-group-addon" id="path">.html</span>
        <span class="input-group-btn">
            <button class="btn btn-primary" type="button" @click="submit('update')">修改</button>
            <button class="btn btn-danger" type="button" @click="submit('delete')">删除</button>
        </span>
    </div>
    <span id="path" class="help-block" v-html="hint"></span>

</div>
<ul class="list-inline">
    <li v-for="filename in pageList">
        <a @click="setfilename(filename)" v-text="filename"></a>
    </li>
</ul>


<div v-if="loading">{% include 'layout/loading.html' %}</div>
<div v-if="!loading" class="form-horizontal">
    <span id="content" class="help-block">
        建议在技术人员指导下修改该部分内容
    </span>
    <textarea class="form-control" aria-describedby="content" rows="30" v-model="content"></textarea>
</div>




{% endblock %} {% block script %}
<script>
    $(document).ready(function () {
        $("ul li#admin-sidebar-2").toggleClass('active');
        vue.refresh();
    });


    var vue = new Vue({
        el: '#app',
        data: {
            path: "",
            content: "",
            pathClass: "",
            hint: "",
            pageList: [],
            loading: false
        },
        methods: {
            submit: function (type) {
                queryStr = '';

                queryStr += 'path' + '=' + this.path + '.html&';
                if (type == 'update')
                    queryStr += 'content' + '=' + this.content + '&';

                postData('/api/pages/edit/' + type + '/', encodeURI(queryStr), (data) => {
                    if (data['status'] == 0) {
                        this.pathClass = "has-success";
                        this.hint = "编辑成功";
                        this.refresh();
                    } else if (data['status'] == 1) {
                        this.pathClass = "has-error";
                        this.hint = "编辑失败";
                    } else {
                        this.pathClass = "has-error";
                        this.hint = "服务器错误";
                    }
                });
            },
            refresh: function () {
                getData('/api/pages/edit/getlist/', data => {
                    this.pageList = data;
                }, 'getList');
            },
            setfilename: function (path) {
                path = path.split('.')
                if (path.length > 1)
                    path.splice(path.length - 1, 1);
                this.path = path.join('.');
            }
        },
        watch: {
            path: function () {
                waitUntilLast('searchPageTemplate', () => {
                    vue.loading = true;
                    postData('/api/pages/edit/get/', encodeURI('path=' + this.path + '.html'), data => {
                        if (data['status'] == '0') {
                            this.content = data['content'];
                            this.pathClass = "has-warning";
                            this.hint = "文件存在";
                        } else {
                            this.pathClass = "has-error";
                            this.hint = "文件不存在";
                        }
                        vue.loading = false;
                    }, 'getTemplate');
                }, 1000);

            },
        }
    });
</script> {% endblock %}