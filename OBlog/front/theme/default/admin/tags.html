{% extends "layout/admin.html" %} {% block title %}标签管理{% endblock %} {% block admin_main %}

<div id="app">
    <div class="row center">

        <div class="row">
            <div class="input-field col s8 offset-s2">
                <input placeholder="选择要编辑的标签..." id="search" type="text" v-model="searchwords">
            </div>
        </div>
        <div class="col s12">
            <div class="row">
                <div class="col s2">
                    名称
                </div>
                <div class="col s2">
                    链接
                </div>
                <div class="col s3">
                    图片
                </div>
                <div class="col s3">
                    颜色
                </div>
                <div class="col s2">
                    修改
                </div>
            </div>
            <div class="row" v-for="tag in tags">
                <form action="/admin/tags/update/" method="post">
                    <div class="col s2">
                        <a v-bind:href="'/tag/'+tag.english">
                            <div class="chip" v-bind:class="tag.class">
                                <img v-bind:src="tag.img" onerror='$(this).attr("style","display:none")' onload='$(this).attr("style","")' />
                                <span v-text='tag.chinese'></span>
                            </div>
                        </a>
                        <input name="chinese" type="hidden" v-bind:value="tag.chinese" />

                    </div>
                    <div class="col s2">
                        <input name="english" type="text" v-bind:value="tag.english" class="validate" pattern="\w*" />
                        <input name="oldenglish" type="hidden" v-bind:value="tag.english" />
                    </div>

                    <div class="col s3">
                        <input id="img" name="img" type="text" v-model="tag.img" />
                    </div>
                    <div class="col s3">
                        <input id="class" name="class" type="text" v-model="tag.class" />
                    </div>
                    <div class="col s2">
                        <button class="waves-effect waves-light btn indigo darken-1" type="submit">修改</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

{% endblock %} {% block script %}
<script>
    $('ul li#管理后台').toggleClass('active');

    // $(document).on('input', 'input#img', function() {
    //     var img = $(this).parent("div.col").parent("div.row").find("div.chip").children("img")
    //     img.attr("src", this.value);
    //     if (img.attr("src") == "")
    //         img.attr("style", "display:none")
    //     else
    //         img.attr("style", "")

    // });

    // $(document).on('input', 'input#class', function() {
    //     $(this).parent("div.col").parent("div.row").find("div.chip").attr("class", "chip " + this.value);
    // });

    var vue = new Vue({
        el: '#app',
        data: {
            tags: [],
            loading: true,
            searchwords: "",
        },
        methods: {}
    });

    vue.$watch('searchwords', search);
    $(document).ready($ => search(vue.searchwords));

    function search(searchwords) {
        vue.loading = true;
        if (searchwords == '') {
            fetchData('/api/tags/', data => {
                vue.tags = data;
                console.log(data);
                vue.loading = false;
            });
        } else {
            fetchData('/api/search_tags/' + searchwords, data => {
                vue.tags = data;
                vue.loading = false;
            });
        }
    }

    function fetchData(url, solve) {
        fetch(url).then(
            response => response.json()
        ).then(
            data => solve(data)
        ).catch(
            e => console.log("Oops, error:" + e)
        );
    }
</script> {% endblock %}